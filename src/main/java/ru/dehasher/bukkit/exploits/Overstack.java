package ru.dehasher.bukkit.exploits;

import org.bukkit.entity.Player;
import org.bukkit.event.Listener;
import org.bukkit.inventory.Inventory;
import org.bukkit.inventory.ItemStack;

import ru.dehasher.bukkit.HCore;
import ru.dehasher.bukkit.managers.Methods;

public class Overstack implements Listener {
    public Overstack(HCore plugin) {}

    public static void checkPlayer(Player player) {
        if (player.isDead()) return;
        if (Methods.isPerm(player, "hcore.bypass.overstack")) return;
        Inventory inventory = player.getInventory();
        for (ItemStack item : inventory) {
            if (isOverstackItem(item)) item.setAmount(1);
        }
    }

    private static boolean isOverstackItem(ItemStack item) {
        if (item == null) return false;
        String name = item.getType().name();
        if (name.equals("AIR")) return false;

        if (item.getAmount() > item.getMaxStackSize()) {
            for (String whitelist : HCore.config.getStringList("fix-exploits.overstack.whitelist")) {
                if (name.equals(whitelist)) return false;
            }
            return true;
        }
        return false;
    }
}
