package ru.dehasher.hcore.exploits;

import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityPortalEvent;
import org.bukkit.event.player.PlayerPortalEvent;

import org.bukkit.event.player.PlayerTeleportEvent;
import ru.dehasher.hcore.HCore;
import ru.dehasher.hcore.managers.Methods;

public class Portals implements Listener {
    public Portals(HCore plugin) {}

    // Обработка взаимодействия игроков с порталами.
    @EventHandler(priority = EventPriority.HIGHEST)
    public void onPlayerPortalEvent(PlayerPortalEvent e) {
        if (!HCore.config.getBoolean("fix-exploits.portal-teleporting.enable-nether-spawn")) return;

        Player player = e.getPlayer();
        String world  = e.getTo().getWorld().getName();

        // Если игрок телепортируется с помощью портала в АД.
        if (e.getCause() == PlayerTeleportEvent.TeleportCause.NETHER_PORTAL) {
            // Если то место куда телепортируется игрок является АДом то телепортируем игрока на адский спавн.
            if (world.endsWith("_nether")) {
                Methods.teleportPlayer(player, Methods.getSpawnLocation("nether"));
            } else { // А если же игрок телепортируется из АДа с помощью портала то тепаем его на спавн верхнего мира.
                Methods.teleportPlayer(player, Methods.getSpawnLocation("overworld"));
            }
            // Отменяем эвент.
            e.setCancelled(true);
        }

        // Если игрок телепортируется с помощью портала в ЭНД.
        if (e.getCause() == PlayerTeleportEvent.TeleportCause.END_PORTAL) {
            // Если мир куда собирается телепортироваться игрок не является ЭНДом.
            if (!world.endsWith("_the_end")) {
                e.setTo(Methods.getSpawnLocation("overworld"));
            }
        }
    }

    // Обработка взаимодействия сущностей с порталом в ад.
    @EventHandler(priority = EventPriority.HIGHEST)
    public void onEntityPortalEvent(EntityPortalEvent e) {
        if (!HCore.config.getBoolean("fix-exploits.portal-teleporting.block-entity-teleport")) return;
        e.setCancelled(true);
    }
}
