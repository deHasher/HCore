package ru.dehasher.hcore.exploits;

import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityPortalEvent;
import org.bukkit.event.player.PlayerPortalEvent;

import org.bukkit.event.player.PlayerTeleportEvent;
import ru.dehasher.hcore.HCore;
import ru.dehasher.hcore.managers.Methods;

public class Portals implements Listener {
    public Portals(HCore plugin) {}

    // Обработка взаимодействия игроков с порталом в ад.
    @EventHandler(priority = EventPriority.HIGHEST)
    public void onPlayerPortalEvent(PlayerPortalEvent e) {
        if (!HCore.config.getBoolean("settings.fix-exploits.portal-teleporting.enable-nether-spawn")) return;

        Player player = e.getPlayer();
        String world  = e.getTo().getWorld().getName();

        if (e.getCause() != PlayerTeleportEvent.TeleportCause.END_PORTAL) {
            if (e.getCause() == PlayerTeleportEvent.TeleportCause.NETHER_PORTAL) {
                if (world.endsWith("_nether")) {
                    Methods.teleportPlayer(player, Methods.getSpawnLocation("nether"));
                } else {
                    Methods.teleportPlayer(player, Methods.getSpawnLocation("overworld"));
                }
            }
            e.setCancelled(true);
        }

    }

    // Обработка взаимодействия сущностей с порталом в ад.
    @EventHandler(priority = EventPriority.HIGHEST)
    public void onEntityPortalEvent(EntityPortalEvent e) {
        if (!HCore.config.getBoolean("settings.fix-exploits.portal-teleporting.block-entity-teleport")) return;
        e.setCancelled(true);
    }
}
