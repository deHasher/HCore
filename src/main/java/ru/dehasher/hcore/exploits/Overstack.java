package ru.dehasher.hcore.exploits;

import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.event.Listener;
import org.bukkit.inventory.Inventory;
import org.bukkit.inventory.ItemStack;

import ru.dehasher.hcore.HCore;
import ru.dehasher.hcore.managers.Methods;

public class Overstack implements Listener {
    public Overstack(HCore plugin) {}

    public static void checkPlayer(Player player) {
    	if (Methods.isPerm(player, "hcore.bypass.overstack")) return;
    	Inventory inventory = player.getInventory();
    	for (ItemStack item : inventory) {
    		if (isOverstackItem(item)) {
    			fixItem(item);
    		}
    	}
    }

    private static void fixItem(ItemStack item) {
    	String name = item.getType().name();
    	for (String whitelist : HCore.config.getStringList("settings.fix-exploits.overstack.whitelist")) {
    		if (whitelist.equals(name)) {
    			return;
    		}
    	}
    	if (item.getAmount() > item.getMaxStackSize()) {
    		item.setAmount(1);
    	}
	}

    private static boolean isOverstackItem(ItemStack item) {
    	if (item == null) return false;

    	Material type = item.getType();

    	if (type == Material.AIR) return false;

    	String name   = type.getData().getName();

    	if (item.getAmount() > item.getMaxStackSize()) {
        	for (String whitelist : HCore.config.getStringList("settings.fix-exploits.overstack.whitelist")) {
        		if (name.equals(whitelist)) {
        			return false;
        		}
        	}
        	return true;
    	} else {
        	return false;
    	}
    }
}
